flowchart TD

%% =====================
%% USER INPUT
%% =====================

U["1. User Input<br>(Text / Image / Audio)"]

OCR["2a. EasyOCR"]
ASR["2b. Whisper Large"]
CC{"3. Confidence/Review Check"}
HITL1["HITL Correction"]:::hitl

%% =====================
%% AGENT PIPELINE
%% =====================

GA["4. Guardrail Agent"]
PA["5. Parser Agent"]
RA["6. Router Agent"]

%% =====================
%% RAG PIPELINE
%% =====================

EM["7. Generate HF Embeddings"]
LDB[("8. Query LanceDB")]
CA["9. Aggregate Context"]
WS["Optional Web Search"]

%% =====================
%% REASONING PIPELINE
%% =====================

SA["10. Solver Agent"]
SY["11. SymPy Tool Execution"]
VA["12. Verifier Agent"]
HITL2["HITL Review"]:::hitl
EA["13. Explainer Agent"]

%% =====================
%% MEMORY + FEEDBACK
%% =====================

SQL[("14. Store in SQLite")]
ME["15. Store Memory Embeddings"]
SPR["Similar Problem Retrieval"]
FB["16. User Feedback"]
FS["Feedback Storage"]

%% =====================
%% FLOW CONNECTIONS
%% =====================

U --> OCR
U --> ASR
U --> CC

OCR --> CC
ASR --> CC

CC -- Low Confidence --> HITL1
HITL1 --> U
CC -- High Confidence --> GA

GA --> PA
PA --> RA

RA --> EM
EM --> LDB
LDB --> CA
WS -.-> CA

CA --> SA
SA --> SY
SY --> SA

SA --> VA
VA -- Uncertain --> HITL2
HITL2 --> SA
VA -- Confident --> EA

EA --> SQL
SQL --> ME
ME --> SPR
SPR -.-> RA

EA --> FB
FB --> FS
FS --> SQL

%% =====================
%% STYLING
%% =====================

classDef hitl fill:#ffccbc,stroke:#e64a19,stroke-width:2px;

```
flowchart TD

%% =====================
%% USER INPUT
%% =====================

U["1. User Input<br>(Text / Image / Audio)"]

OCR["2a. EasyOCR"]
ASR["2b. Whisper Large"]
CC{"3. Confidence/Review Check"}
HITL1["HITL Correction"]:::hitl

%% =====================
%% AGENT PIPELINE
%% =====================

GA["4. Guardrail Agent"]
PA["5. Parser Agent"]
RA["6. Router Agent"]

%% =====================
%% RAG PIPELINE
%% =====================

EM["7. Generate HF Embeddings"]
LDB[("8. Query LanceDB")]
CA["9. Aggregate Context"]
WS["Optional Web Search"]

%% =====================
%% REASONING PIPELINE
%% =====================

SA["10. Solver Agent"]
SY["11. SymPy Tool Execution"]
VA["12. Verifier Agent"]
HITL2["HITL Review"]:::hitl
EA["13. Explainer Agent"]

%% =====================
%% MEMORY + FEEDBACK
%% =====================

SQL[("14. Store in SQLite")]
ME["15. Store Memory Embeddings"]
SPR["Similar Problem Retrieval"]
FB["16. User Feedback"]
FS["Feedback Storage"]

%% =====================
%% FLOW CONNECTIONS
%% =====================

U --> OCR
U --> ASR
U --> CC

OCR --> CC
ASR --> CC

CC -- Low Confidence --> HITL1
HITL1 --> U
CC -- High Confidence --> GA

GA --> PA
PA --> RA

RA --> EM
EM --> LDB
LDB --> CA
WS -.-> CA

CA --> SA
SA --> SY
SY --> SA

SA --> VA
VA -- Uncertain --> HITL2
HITL2 --> SA
VA -- Confident --> EA

EA --> SQL
SQL --> ME
ME --> SPR
SPR -.-> RA

EA --> FB
FB --> FS
FS --> SQL

%% =====================
%% STYLING
%% =====================

classDef hitl fill:#ffccbc,stroke:#e64a19,stroke-width:2px;
```
